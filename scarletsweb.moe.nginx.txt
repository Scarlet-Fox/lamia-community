upstream app_servers {
	server 127.0.0.1:5001;
}
upstream socketio {
	server 127.0.0.1:3000;
}
upstream node {
	server 127.0.0.1:3001;
}

server {
       listen         80;
       server_name    scarletsweb.moe www.scarletsweb.moe;
       return         301 https://$server_name$request_uri;
}

server {
	server_name scarletsweb.moe www.scarletsweb.moe;
	add_header Strict-Transport-Security "max-age=31536000";
	client_max_body_size 50M;
	listen 443 ssl;
	root /home/sally/public_html;
	index index.html index.htm index.php;
	ssl_certificate     /etc/keys/scarletsweb.chain.crt;
	ssl_certificate_key /etc/keys/scarletsweb.key;
	#access_log /var/log/virtualmin/worldofequestria.com_access_log;
	#error_log /var/log/virtualmin/worldofequestria.com_error_log;
	location ^~ /static/  {
	    root /home/sally/Sally/woe;
	    expires 7d;
	}

	location /listener {
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_http_version 1.1;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header Host $host;
            proxy_pass http://socketio;
    	}

        location /talker {
            #proxy_set_header Upgrade $http_upgrade;
            #proxy_set_header Connection "upgrade";
            #proxy_http_version 1.1;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header Host $host;
            proxy_pass http://node;
        }


	location / {
            proxy_pass         http://app_servers;
            proxy_redirect     off;
            proxy_set_header   Host $host;
            proxy_set_header   X-Real-IP $remote_addr;
            proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header   X-Forwarded-Host $server_name;
       }
}

