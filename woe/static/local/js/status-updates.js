// Generated by CoffeeScript 1.9.3
(function() {
  $(function() {
    var Status;
    Status = (function() {
      function Status() {
        this.id = $("#status").attr("data-id");
        this.refreshView();
      }

      Status.prototype.addReply = function() {
        return $.post("/status/" + this.id + "/", {
          text: $("#status-reply")[0].value,
          reply: true
        }, (function(_this) {
          return function(response) {
            $("#status-reply")[0].value = "";
            return _this.refreshView(true);
          };
        })(this));
      };

      Status.prototype.replyTMPL = function(vars) {
        return "<div class=\"status-reply\" data-id=\"" + vars.pk + "\">  \n  <img src=\"" + vars.user_avatar + "\" width=\"" + vars.user_avatar_x + "px\" height=\"" + vars.user_avatar_y + "px\">\n  <p><a href=\"#\">" + vars.user_name + "</a><span class=\"status-mod-controls\"></span>\n  <br>" + vars.text + "\n  <br><span class=\"status-reply-time\">" + vars.time + "</span></p>\n  <hr>\n</div>";
      };

      Status.prototype.refreshView = function(scrolldown) {
        if (scrolldown == null) {
          scrolldown = false;
        }
        return $.get("/status/" + this.id + "/replies", {}, (function(_this) {
          return function(response) {
            var comment, i, len, ref;
            $("#status-replies").html("");
            ref = response.replies;
            for (i = 0, len = ref.length; i < len; i++) {
              comment = ref[i];
              $("#status-replies").append(_this.replyTMPL(comment));
            }
            if (scrolldown) {
              return $("#status-replies").scrollTop($('#status-replies')[0].scrollHeight);
            }
          };
        })(this));
      };

      return Status;

    })();
    window.status_ = new Status;
    return $("#submit-reply").click(function(e) {
      e.preventDefault();
      return s.addReply();
    });
  });

}).call(this);
