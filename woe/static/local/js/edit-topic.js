// Generated by CoffeeScript 1.10.0
(function() {
  $(function() {
    var EditTopic;
    EditTopic = (function() {
      function EditTopic(slug) {
        var edit_topic;
        this.slug = slug;
        this.inline_editor = new InlineEditor("#new-post-box", "", true, true);
        this.meta = {};
        this.poll = {};
        edit_topic = self;
        this.inline_editor.onSave(function(html, text, edit_reason) {
          var meta, poll, prefix, title;
          title = $("#title").val();
          prefix = $("#prefix").val();
          meta = edit_topic.meta;
          poll = edit_topic.poll;
          return $.post("/t/" + slug + "/edit-topic", JSON.stringify({
            html: html,
            text: text,
            meta: meta,
            title: title,
            prefix: prefix,
            poll: poll,
            edit_reason: edit_reason
          }), (function(_this) {
            return function(data) {
              console.log(data);
              if (data.error != null) {
                return topic.inline_editor.flashError(data.error);
              } else {
                return window.location = "/t/" + slug;
              }
            };
          })(this));
        });
        this.inline_editor.onCancel(function(html, text) {
          return window.location = "/t/" + slug;
        });
      }

      return EditTopic;

    })();
    return window.topic = new EditTopic($("#edit-topic-form").data("slug"));
  });

}).call(this);
