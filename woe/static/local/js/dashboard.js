// Generated by CoffeeScript 1.9.3
(function() {
  $(function() {
    var Dashboard;
    Dashboard = (function() {
      function Dashboard() {
        this.categories = {};
        this.notificationTemplate = Handlebars.compile(this.notificationHTML());
        this.panelTemplate = Handlebars.compile(this.panelHTML());
        this.dashboard_container = $("#dashboard-container");
        this.category_names = {
          topic: "Topics",
          pm: "Private Messages",
          mention: "Mentioned",
          topic_reply: "Topic Replies",
          boop: "Boops",
          mod: "Moderation",
          status: "Status Updates",
          new_member: "New Members",
          announcement: "Announcements",
          profile_comment: "Profile Comments",
          rules_updated: "Rule Update",
          faqs: "FAQs Updated",
          user_activity: "Followed:User Activity",
          streaming: "Streaming",
          other: "Other"
        };
        this.buildDashboard();
        $("#dashboard-container").delegate(".ack_all", "click", function(e) {
          var panel;
          e.preventDefault();
          panel = $("#" + $(this).data("panel"));
          return $.post("/dashboard/ack_category", JSON.stringify({
            category: panel.attr("id")
          }), function(data) {
            if (data.success != null) {
              return panel.remove();
            }
          });
        });
        $("#dashboard-container").delegate(".ack_single", "click", function(e) {
          var notification, panel, panel_notifs;
          e.preventDefault();
          notification = $("#" + $(this).data("notification"));
          panel_notifs = $("#notifs-" + $(this).data("panel"));
          panel = $("#" + $(this).data("panel"));
          return $.post("/dashboard/ack_notification", JSON.stringify({
            notification: notification.attr("id")
          }), function(data) {
            if (data.success != null) {
              if (panel_notifs.children().length < 2) {
                return panel.remove();
              } else {
                return notification.remove();
              }
            }
          });
        });
      }

      Dashboard.prototype.addToPanel = function(notification) {
        var category_element, panel;
        category_element = $("#notifs-" + notification.category);
        if (category_element.length === 0) {
          panel = {
            panel_id: notification.category,
            panel_title: this.category_names[notification.category]
          };
          this.dashboard_container.append(this.panelTemplate(panel));
          category_element = $("#notifs-" + notification.category);
        }
        return category_element.append(this.notificationTemplate(notification));
      };

      Dashboard.prototype.buildDashboard = function() {
        return $.post("/dashboard/notifications", {}, (function(_this) {
          return function(response) {
            var i, len, notification, ref, results;
            ref = response.notifications;
            results = [];
            for (i = 0, len = ref.length; i < len; i++) {
              notification = ref[i];
              results.push(_this.addToPanel(notification));
            }
            return results;
          };
        })(this));
      };

      Dashboard.prototype.notificationHTML = function() {
        return "<li class=\"list-group-item\" id=\"{{_id}}\" data-stamp=\"{{stamp}}\">\n  <a href=\"{{url}}\">{{text}}</a><button class=\"close ack_single\" data-notification=\"{{_id}}\" data-panel=\"{{category}}\">&times;</button>\n  <p class=\"text-muted\"> by <a href=\"/members/{{member_name}}/\">{{member_disp_name}}</a> - {{time}}</p>\n</li>";
      };

      Dashboard.prototype.panelHTML = function() {
        return "<div class=\"col-sm-6 col-md-4 dashboard-panel\" id=\"{{panel_id}}\">\n  <div class=\"panel panel-default\">\n    <div class=\"panel-heading\">\n      <span>{{panel_title}}</span>\n      <button class=\"close ack_all\" data-panel=\"{{panel_id}}\">&times;</button>\n    </div>\n    <ul class=\"list-group panel-body\" id=\"notifs-{{panel_id}}\">\n    </ul>\n  </div>\n</div>";
      };

      return Dashboard;

    })();
    return window.woeDashboard = new Dashboard;
  });

}).call(this);
