// Generated by CoffeeScript 1.9.3
(function() {
  $(function() {
    var resultTemplate, resultTemplateHTML;
    $(".variable-option").hide();
    $(".posts-option").show();
    $("#start-date").datepicker({
      format: "m/d/yy",
      clearBtn: true
    });
    $("#end-date").datepicker({
      format: "m/d/yy",
      clearBtn: true
    });
    $("#content-search").change(function(e) {
      var content_type;
      content_type = $(this).val();
      if (content_type === "posts") {
        $(".variable-option").hide();
        return $(".posts-option").show();
      } else if (content_type === "topics") {
        $(".variable-option").hide();
        return $(".topics-option").show();
      } else if (content_type === "status") {
        return $(".variable-option").hide();
      } else if (content_type === "messages") {
        $(".variable-option").hide();
        return $(".messages-option").show();
      }
    });
    return $("#author-select").select2({
      ajax: {
        url: "/user-list-api",
        dataType: 'json',
        delay: 250,
        data: function(params) {
          return {
            q: params.term
          };
        },
        processResults: function(data, page) {
          console.log({
            results: data.results
          });
          return {
            results: data.results
          };
        },
        cache: true
      },
      minimumInputLength: 2
    }, $("#topic-select").select2({
      ajax: {
        url: "/topic-list-api",
        dataType: 'json',
        delay: 250,
        data: function(params) {
          return {
            q: params.term
          };
        },
        processResults: function(data, page) {
          console.log({
            results: data.results
          });
          return {
            results: data.results
          };
        },
        cache: true
      },
      minimumInputLength: 2
    }), $("#category-select").select2({
      ajax: {
        url: "/category-list-api",
        dataType: 'json',
        delay: 250,
        data: function(params) {
          return {
            q: params.term
          };
        },
        processResults: function(data, page) {
          console.log({
            results: data.results
          });
          return {
            results: data.results
          };
        },
        cache: true
      },
      minimumInputLength: 2
    }), $("#pm-topic-select").select2({
      ajax: {
        url: "/pm-topic-list-api",
        dataType: 'json',
        delay: 250,
        data: function(params) {
          return {
            q: params.term
          };
        },
        processResults: function(data, page) {
          console.log({
            results: data.results
          });
          return {
            results: data.results
          };
        },
        cache: true
      },
      minimumInputLength: 2
    }), resultTemplateHTML = function() {
      return "<ul class=\"list-group\">\n  <li class=\"list-group-item\">\n    <p>\n      <b>\n        <a href=\"{{url}}\">{{{title}}}</a>\n      </b>\n    </p>\n    <div class=\"search-result-content\">\n      <p>\n        {{{description}}}\n        {{#if readmore}}\n        <a href=\"{{url}}\" class=\"readmore\">\n          <br><b>Read more Â»</b>\n        </a>\n        {{/if}}\n      </p>\n    </div>\n    <p class=\"text-muted\">by <a href=\"{{author_profile_link}}\">{{author_name}}</a> - {{time}}\n    </p>\n  </li>\n</ul>";
    }, resultTemplate = Handlebars.compile(resultTemplateHTML()), $("#search").click(function(e) {
      var content_type, data;
      e.preventDefault();
      content_type = $("#content-search").val();
      data = {
        q: $("#search-for").val(),
        content_type: content_type
      };
      if ($("#start-date").val() !== "") {
        data["start_date"] = $("#start-date").val();
      }
      if ($("#end-date").val() !== "") {
        data["end_date"] = $("#end-date").val();
      }
      if (content_type === "messages") {
        data["topics"] = $("#pm-topic-select").val();
      }
      if (content_type === "posts") {
        data["topics"] = $("#topic-select").val();
      }
      if (content_type === "topics") {
        data["categories"] = $("#category-select").val();
      }
      return $.post("/search", JSON.stringify(data), function(data) {
        var _html, i, len, ref, result;
        _html = "";
        ref = data.results;
        for (i = 0, len = ref.length; i < len; i++) {
          result = ref[i];
          _html = _html + resultTemplate(result);
        }
        $("#search-results").html(_html);
        $(".search-result-content img").hide();
        return $(".search-result-content").dotdotdot({
          height: 200,
          after: ".readmore"
        });
      });
    }));
  });

}).call(this);
