// Generated by CoffeeScript 1.12.6
(function() {
  $(function() {
    var getSelectionText, inline_editor;
    $(".boop-link").click(function(e) {
      var count, current_status, element;
      e.preventDefault();
      element = $(this);
      current_status = element.data("status");
      count = parseInt(element.data("count"));
      return $.post(element.attr("href"), JSON.stringify({}), function(data) {
        if (current_status === "notbooped") {
          element.children(".boop-text").text("Boop!");
          element.children(".badge").text("");
          element.data("status", "booped");
          return element.data("count", count + 1);
        } else {
          element.children(".boop-text").html("");
          element.data("status", "notbooped");
          element.children(".boop-text").text(" Boop");
          element.data("count", count - 1);
          element.children(".badge").text(element.data("count"));
          return element.children(".badge").css("background-color", "#555");
        }
      });
    });
    if ($("#new-post-box").length > 0) {
      inline_editor = new InlineEditor("#new-post-box", "", false, false, 150);
      getSelectionText = function() {
        var text;
        text = "";
        if (window.getSelection) {
          text = window.getSelection().toString();
        } else if (document.selection && document.selection.type !== "Control") {
          text = document.selection.createRange().text;
        }
        return text;
      };
      $(".list-group-item").delegate(".reply-button", "click", function(e) {
        var current_position, element, highlighted_text, my_content, post_object, x, y;
        e.preventDefault();
        try {
          post_object = getSelectionParentElement().closest(".post-content");
        } catch (error) {
          post_object = null;
        }
        highlighted_text = getSelectionText().trim();
        element = $(this);
        my_content = "";
        if ((post_object != null) && post_object === $("#post-" + (element.data("pk")))[0]) {
          my_content = "[reply=" + (element.data("pk")) + ":blogcomment:" + (element.data("author")) + "]\n" + highlighted_text + "\n[/reply]";
        } else {
          my_content = "[reply=" + (element.data("pk")) + ":blogcomment:" + (element.data("author")) + "][/reply]\n\n";
        }
        x = window.scrollX;
        y = window.scrollY;
        try {
          inline_editor.quill.focus();
        } catch (error) {
          current_position = 0;
        }
        window.scrollTo(x, y);
        if (current_position == null) {
          current_position = inline_editor.quill.getSelection(true).index;
          if (current_position == null) {
            current_position = inline_editor.quill.getLength();
          }
        }
        return inline_editor.quill.insertText(current_position, my_content);
      });
      return inline_editor.onSave(function(html, text) {
        inline_editor.disableSaveButton();
        return $.post($("#entry-url").attr("href") + "/new-comment", JSON.stringify({
          post: html,
          text: text
        }), (function(_this) {
          return function(data) {
            if (data.no_content != null) {
              inline_editor.flashError("You forgot to write something.");
            }
            if (data.error != null) {
              inline_editor.flashError(data.error);
            }
            if (data.success != null) {
              inline_editor.clearEditor();
              return window.location = data.url;
            } else {
              return inline_editor.enableSaveButton();
            }
          };
        })(this));
      });
    }
  });

}).call(this);
