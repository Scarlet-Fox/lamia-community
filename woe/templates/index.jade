{% extends "base.jade" %}

{% block content %}
.row
  .col-md-8
    {% for section in sections %}
    ul.list-group.category
      li.list-group-item.section-header.category-section-header {{section.name}}
      {% for category in categories[section] %}
      li.list-group-item.subcategory.category-subcategories
        div
          .row
            .col-xs-4.col-sm-6
              span.subcategory-listing-name 
                a(href="/category/{{category.slug}}") {{category.name}}
                {% for subcategory in sub_categories[category] %}
                {% if loop.first %}
                p.small
                  &nbsp;
                  {% endif %}
                  a(href="/category/{{subcategory.slug}}") {{subcategory.name}}{% if not loop.last %}, {% endif %}
                  {% endfor %}
            {% if category.recent_post %}
            .col-sm-6.col-xs-8
              .media-left
                span.subcategory-listing-recent-image
                  a(href="{{url_for('view_profile', login_name=category.recent_post.author.login_name)}}")
                    img(src="{{category.recent_post.author.get_avatar_url("40")}}", width="{{category.recent_post.author.avatar_40_x}}", height="{{category.recent_post.author.avatar_40_y}}", class="avatar-mini")
              .media-body
                span.subcategory-listing-recent
                  a(href="/t/{{category.recent_topic.slug}}")= category.recent_topic.title|truncate(40)
                  br
                  a(href="/t/{{category.recent_topic.slug}}/page/1/post/last_seen") {{category.recent_post.created|humanize_time}}
            {% endif %}
      {% endfor %}
    {% endfor %}
    .row
      .col-md-6
        ul.list-group
          li.list-group-item.section-header.sidebar-section-header New Topics
          for t in recently_created_topics
            li.list-group-item
              .media-left
                span.subcategory-listing-recent-image
                  a(href="{{url_for('view_profile', login_name=t.author.login_name)}}")
                    img(src="{{t.author.get_avatar_url("40")}}", width="{{t.author.avatar_40_x}}", height="{{t.author.avatar_40_y}}", class="avatar-mini")
              .media-body
                a(href="/t/{{t.slug}}")= t.title|truncate(40)
                br
                a(href="/t/{{t.slug}}/page/1/post/last_seen") {{t.created|humanize_time}}
      .col-md-6
        ul.list-group
          li.list-group-item.section-header.sidebar-section-header Recently Replied to Topics
          for t in recently_replied_topics
            li.list-group-item
              .media-left
                span.subcategory-listing-recent-image
                  a(href="{{url_for('view_profile', login_name=t.recent_post.author.login_name)}}")
                    img(src="{{t.recent_post.author.get_avatar_url("40")}}", width="{{t.recent_post.author.avatar_40_x}}", height="{{t.recent_post.author.avatar_40_y}}", class="avatar-mini")
              .media-body
                a(href="/t/{{t.slug}}/page/1/post/latest_post")= t.title|truncate(40)
                br
                a(href="/t/{{t.slug}}/page/1/post/latest_post") {{t.recent_post.created|humanize_time}}
  .col-md-4
    if announcements
      ul.list-group
        li.list-group-item.section-header.sidebar-section-header Announcements
        for announcement in announcements
          li.list-group-item(style="padding: 10px;")
            .media-left 
              a(href="/member/{{announcement.author.login_name}}")
                img.avatar-mini(src=announcement.author.get_avatar_url("60"), width=announcement.author.avatar_60_x, height=announcement.author.avatar_60_y)
            .media-body
              strong
                a(href="/t/{{announcement.slug}}")= announcement.title
              div= announcement.created|humanize_time("MMM D YYYY")
    
    ul.list-group
      li.list-group-item.section-header.sidebar-section-header Status Updates
      {% for status in status_updates %}
      li.list-group-item.front-page-status.sidebar-status-section
        .media-left.subcategory-listing-recent-image
          a(href="{{url_for('view_profile', login_name=status.author.login_name)}}")
            img.media-object(src="{{ status.author.get_avatar_url("60") }}", width="{{ status.author.avatar_60_x }}", height="{{ status.author.avatar_60_y }}", class="avatar-mini")
        .media-body
          a.hover_user(href="{{url_for('view_profile', login_name=status.author.login_name)}}") {{ status.author.display_name }}
          span &nbsp;says:
          span.discuss 
            a(href="/status/{{status.id}}") Discuss{% if status.get_comment_count() %} ({{status.get_comment_count()}}) {% endif %}
          br
          p.status-message {{status.message}}
          span.status-reply-time 
            a(href="/status/{{status.id}}") {{ status.created|humanize_time }}
      {% endfor %}
      if current_user.is_authenticated()
        li.list-group-item
          center
            p
            form.form-group.status-reply-box
              input.form-control#status-new(type="text", maxlength="250")
              br
              button#new-status.btn.btn-primary(type="submit") Create a Status Update
      if blogs
        ul.list-group(style="padding-top: 10px;")
          li.list-group-item.section-header Blogs
          for blog in blogs
            li.list-group-item(style="padding: 10px;")
              .media-left.subcategory-listing-recent-image
                a(href="/member/{{blog.recent_entry.author.login_name}}")
                  img.avatar-mini(src=blog.recent_entry.author.get_avatar_url("60"), width=blog.recent_entry.author.avatar_60_x, height=blog.recent_entry.author.avatar_60_y)
              .media-body
                strong
                  a(href="/blog/{{blog.slug}}/e/{{blog.recent_entry.slug}}")= blog.recent_entry.title
                div
                  a(href="/blog/{{blog.slug}}")= blog.name
                div= blog.recent_entry.published|humanize_time("MMM D YYYY")
          li.list-group-item
            center
              a.btn.btn-primary(href="/blogs") Browse All Blogs
      if newest_member
        ul.list-group
          li.list-group-item.section-header Newest Member
          li.list-group-item 
            .media-left 
              a.subcategory-listing-recent-image(href="/member/{{newest_member.login_name}}")
                img.avatar-mini(src=newest_member.get_avatar_url("60"), width=newest_member.avatar_60_x, height=newest_member.avatar_60_y)
            .media-body Our newest member is 
              a.hover_user(href="{{url_for('view_profile', login_name=newest_member.login_name)}}") {{newest_member.display_name}}
              if new_member_intro_topic
                |&nbsp;and they have a 
                a(href="/t/{{new_member_intro_topic.slug}}") welcome topic.
                br
                a(href="/t/{{new_member_intro_topic.slug}}") Go say hello!
              else
                |but they have no welcome topic. :(
.row
  .col-md-12
    li.list-group-item.section-header.sidebar-section-header {{online_user_count}} Users Online
    li.list-group-item
        {% for u in online_users %}
        {% if u.anonymous_login == False %}
        a.hover_user(data-hplacement="top", href="{{url_for('view_profile', login_name=u.login_name)}}") {{u.display_name}}
        span {% if not loop.last %},{% endif %} 
        {% else %}
        {% if current_user.is_admin %}
        i
          a.hover_user(data-hplacement="top", href="{{url_for('view_profile', login_name=u.login_name)}}") {{u.display_name}}
        span {% if not loop.last %},{% endif %} 
        {% endif %}
        {% endif %} 
        {% endfor %}
{% endblock %}

{% block script %}
script(type="text/javascript").
  $(document).ready(function(){
  $('#forum-li').addClass('active');
  });
{% endblock %}
